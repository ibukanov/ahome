#!/bin/sh

error() {
    echo "$@" 1>&2 ; exit 1
}


name="$1"
version="$2"
shift 2

test -z "$version" && version="indigo"

test "kepler" == "$version" -o "indigo" == "$version" || \
    error "Unsupported version: $version"

rdir="$HOME/r"

case "$name" in
  sds ) workspace="$rdir/e/sds/workspace" ;;
  car | carrasius ) workspace="$rdir/e/carrasius/workspace" ;;
  test ) workspace="$rdir/e/test/workspace" ;;
  timesheet | ts )   workspace="$rdir/timesheet" ;;
  * ) echo "Unknown setup name: '$name'" 1>&2 ; exit 1 ;; 
esac

eclipse=/usr/bin/eclipse
config=""
jdk="default"
vm_args=""
case "$(uname -m)" in
    x86_64 )
	test "indigo" == "$version" && eclipse="$HOME/opt/x86_64/eclipse-$version/eclipse"
	jdk="$HOME/opt/x86_64/jdk1.7"
	;;
    armv7l )
	if test -d "$HOME/opt/jdk7"; then
	    jdk="$HOME/opt/jdk7"
	    export CLASSPATH="/usr/lib/java/swt-gtk-3.7.2.jar"
	    export LD_LIBRARY_PATH="$LD_LIBRARY_PATH${LD_LIBRARY_PATH:+:}/usr/lib/jni"
#	    vm_args="-Djava.library.path=/usr/lib/jni"
	else
	    vm_args="-Xint"
	fi
	;;
esac

config="-configuration $rdir/soft/eclipse-$version-config"

test -d "$workspace" || mkdir -p "$workspace"

vm_args="-vmargs $vm_args -Xincgc -Xms256M -Xmx384M -XX:MaxPermSize=128M"

exec u-jdk "$jdk" "$eclipse" $config -data "$workspace" $vm_args
