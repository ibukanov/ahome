#!/bin/bash

if test -n "$SSH_AUTH_SOCK"; then
    agent_link="$HOME/.ssh/screen_ssh_agent";
    rm -f "$agent_link"
    ln -s "$SSH_AUTH_SOCK" "$agent_link"
    export SSH_AUTH_SOCK="$agent_link"
fi

if tmux has-session > /dev/null 2>&1; then
    exec tmux attach -d
else
    # Remove unwanted variables
    exec env -u SSH_CLIENT -u SSH_CONNECTION -u SSH_TTY -u COLORTERM \
	bash -l -c "exec tmux new-session 'emacs -nw'"
fi
