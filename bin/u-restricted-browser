#!/bin/bash

set -e -u
shopt -s lastpipe

d="$HOME/.cache/restricted-browser"

[[ -d $d/Downloads ]] || mkdir -p "$d/Downloads"

options=(
    --profile=/etc/firejail/brave.profile
    --name="restricted-browser"
    --x11=xpra
    --private="$d"
    --no3d
    --ipc-namespace
)

cmd=(brave)

u-display-dimensions | read _ pixel_width _
if [[ $pixel_width -gt 1600 ]]; then
    cmd+=(--force-device-scale-factor=2)
fi

exec firejail "${options[@]}" "${cmd[@]}" "$@"
