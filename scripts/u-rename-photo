#!/bin/sh

shopt -s extglob

do_it() {
  min_width=3
  if test $# -ge 1000; then
    echo "Too many files to rename :$#" 1>&2
    exit 1
  fi

  counter=0
  for i; do
    counter=$(($counter + 1))
    case "$i" in
      *.[jJ][pP][gG]) extension='.jpg' ;;
      *.[gG][iF][fF]) extension='.gif' ;;
      *.[pP][nN][gG]) extension='.png' ;;
      * )
        echo "Unknown extension: $i" 1>&2;
        exit 1
        ;;
    esac
    newname="$(printf %0${min_width}u $counter)${extension}"
    if test "$i" = "$newname"; then
      echo "Skipping rename as the file already has name $newname" 1>&2
    else
      mv "$i" "$newname"
    fi
  done
}

for dir; do
  (cd "$dir"; do_it *.?([jJ][pP][gG]|[gG][iF][fF]|[pP][nN][gG]) )
done
